<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All Runs ‚Äî Run, Ganis, Run!</title>
  <link rel="stylesheet" href="css/shared.css">
  <style>
    body {
      background: #FFF9C4;
      color: var(--black);
    }
    
    /* Bauhaus decorations */
    .bg-circle {
      width: 350px;
      height: 350px;
      background: var(--yellow);
      opacity: 0.4;
      bottom: -100px;
      left: -100px;
    }
    
    .bg-square {
      width: 180px;
      height: 180px;
      background: var(--blue);
      top: 100px;
      right: -60px;
    }
    
    .bg-circle-2 {
      width: 80px;
      height: 80px;
      background: var(--red);
      top: 30%;
      left: 5%;
    }
    
    .page-header {
      background: var(--yellow);
      color: var(--black);
    }
    
    .page-header .subtitle {
      color: var(--gray);
    }
    
    /* Table styling */
    .table-container {
      overflow-x: auto;
      margin-top: 24px;
    }
    
    .data-table th {
      position: sticky;
      top: 60px;
    }
    
    .distance-col {
      font-weight: 700;
      color: var(--blue);
    }
    
    .pace-col {
      font-family: 'DM Mono', monospace;
    }
    
    /* Filters */
    .filters {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    
    .filter-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .filter-label {
      font-size: 0.875rem;
      color: var(--gray);
    }
    
    select {
      padding: 8px 12px;
      border: 2px solid var(--black);
      background: var(--white);
      font-family: inherit;
      font-size: 0.875rem;
      cursor: pointer;
    }
    
    /* Stats bar */
    .stats-bar {
      display: flex;
      gap: 24px;
      padding: 16px 24px;
      background: var(--black);
      color: var(--white);
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    
    .stats-bar-item {
      display: flex;
      align-items: baseline;
      gap: 8px;
    }
    
    .stats-bar-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--yellow);
    }
    
    .stats-bar-label {
      font-size: 0.75rem;
      color: var(--gray);
    }
    
    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 24px;
    }
    
    .page-btn {
      padding: 8px 16px;
      border: 2px solid var(--black);
      background: var(--white);
      cursor: pointer;
      font-family: inherit;
      font-weight: 500;
    }
    
    .page-btn:hover {
      background: var(--light);
    }
    
    .page-btn.active {
      background: var(--black);
      color: var(--white);
    }
    
    .page-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="bauhaus-circle bg-circle"></div>
  <div class="bauhaus-square bg-square"></div>
  <div class="bauhaus-circle bg-circle-2"></div>
  
  <nav class="nav">
    <a href="index.html" class="nav-brand">
      <div class="musang-container">
        <div class="musang-body">ü¶ù</div>
        <div class="dust"></div>
        <div class="dust"></div>
        <div class="dust"></div>
      </div>
      <span class="nav-title">Run, Ganis, Run!</span>
    </a>
    <div class="nav-links">
      <a href="index.html" class="nav-link">This Week</a>
      <a href="dashboard.html" class="nav-link">Dashboard</a>
      <a href="heatmap.html" class="nav-link">Heatmap</a>
      <a href="runs.html" class="nav-link active">All Runs</a>
    </div>
  </nav>

  <header class="page-header">
    <h1>All Runs</h1>
    <p class="subtitle">Every run since 2017</p>
  </header>

  <main class="container">
    <div class="stats-bar">
      <div class="stats-bar-item">
        <span class="stats-bar-value" id="totalRuns">-</span>
        <span class="stats-bar-label">total runs</span>
      </div>
      <div class="stats-bar-item">
        <span class="stats-bar-value" id="totalDistance">-</span>
        <span class="stats-bar-label">km total</span>
      </div>
      <div class="stats-bar-item">
        <span class="stats-bar-value" id="totalHours">-</span>
        <span class="stats-bar-label">hours</span>
      </div>
      <div class="stats-bar-item">
        <span class="stats-bar-value" id="avgPace">-</span>
        <span class="stats-bar-label">avg pace</span>
      </div>
    </div>

    <div class="filters">
      <div class="filter-group">
        <span class="filter-label">Year:</span>
        <select id="yearFilter">
          <option value="all">All Years</option>
        </select>
      </div>
      <div class="filter-group">
        <span class="filter-label">Show:</span>
        <select id="limitFilter">
          <option value="25">25 runs</option>
          <option value="50">50 runs</option>
          <option value="100">100 runs</option>
          <option value="all">All runs</option>
        </select>
      </div>
    </div>

    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Date</th>
            <th>Name</th>
            <th>Distance</th>
            <th>Time</th>
            <th>Pace</th>
          </tr>
        </thead>
        <tbody id="runsTable">
        </tbody>
      </table>
    </div>

    <div class="pagination" id="pagination"></div>
  </main>

  <footer class="page-footer">
    Data from Strava ¬∑ 808+ runs logged
  </footer>

  <script>
    let allRuns = [];
    let filteredRuns = [];
    let currentPage = 1;
    const perPage = 25;

    async function loadData() {
      try {
        const res = await fetch('data/activities.json');
        const activities = await res.json();
        
        // Filter only runs
        allRuns = activities
          .filter(a => a.type === 'Run')
          .map((a, i) => ({
            date: a.start_date_local.split('T')[0],
            year: a.start_date_local.substring(0, 4),
            name: a.name.split(',')[0].substring(0, 30),
            distance: (a.distance / 1000).toFixed(2),
            time: Math.round(a.moving_time / 60),
            pace: ((a.moving_time / 60) / (a.distance / 1000)).toFixed(2)
          }));
        
        // Populate year filter
        const years = [...new Set(allRuns.map(r => r.year))].sort().reverse();
        const yearSelect = document.getElementById('yearFilter');
        years.forEach(y => {
          const opt = document.createElement('option');
          opt.value = y;
          opt.textContent = y;
          yearSelect.appendChild(opt);
        });
        
        // Stats
        const totalDist = allRuns.reduce((sum, r) => sum + parseFloat(r.distance), 0);
        const totalTime = allRuns.reduce((sum, r) => sum + r.time, 0);
        document.getElementById('totalRuns').textContent = allRuns.length;
        document.getElementById('totalDistance').textContent = totalDist.toFixed(0);
        document.getElementById('totalHours').textContent = (totalTime / 60).toFixed(0);
        document.getElementById('avgPace').textContent = (totalTime / totalDist).toFixed(2) + '/km';
        
        applyFilters();
      } catch (e) {
        console.error('Error loading data:', e);
      }
    }

    function applyFilters() {
      const year = document.getElementById('yearFilter').value;
      const limit = document.getElementById('limitFilter').value;
      
      filteredRuns = year === 'all' 
        ? [...allRuns] 
        : allRuns.filter(r => r.year === year);
      
      if (limit !== 'all') {
        filteredRuns = filteredRuns.slice(0, parseInt(limit));
      }
      
      currentPage = 1;
      renderTable();
    }

    function renderTable() {
      const tbody = document.getElementById('runsTable');
      const start = (currentPage - 1) * perPage;
      const pageRuns = filteredRuns.slice(start, start + perPage);
      
      tbody.innerHTML = pageRuns.map((r, i) => `
        <tr>
          <td>${start + i + 1}</td>
          <td>${r.date}</td>
          <td>${r.name}</td>
          <td class="distance-col">${r.distance} km</td>
          <td>${r.time} min</td>
          <td class="pace-col">${r.pace}/km</td>
        </tr>
      `).join('');
      
      renderPagination();
    }

    function renderPagination() {
      const totalPages = Math.ceil(filteredRuns.length / perPage);
      const pagination = document.getElementById('pagination');
      
      if (totalPages <= 1) {
        pagination.innerHTML = '';
        return;
      }
      
      let html = `
        <button class="page-btn" onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>‚Üê Prev</button>
        <span style="padding: 8px;">Page ${currentPage} of ${totalPages}</span>
        <button class="page-btn" onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Next ‚Üí</button>
      `;
      pagination.innerHTML = html;
    }

    function goToPage(page) {
      currentPage = page;
      renderTable();
      window.scrollTo({ top: 200, behavior: 'smooth' });
    }

    // Event listeners
    document.getElementById('yearFilter').addEventListener('change', applyFilters);
    document.getElementById('limitFilter').addEventListener('change', applyFilters);

    loadData();
  </script>
</body>
</html>
